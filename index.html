<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Static's Infinite Factory Tycoon</title>
  <style>
    /* Global Styles */
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      color: #fff;
      text-align: center;
      transition: background 0.5s ease;
    }
    .container {
      max-width: 900px;
      margin: auto;
      background: rgba(0, 0, 0, 0.85);
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(255, 255, 255, 0.1);
      position: relative;
    }
    /* Button base style */
    .button {
      padding: 10px 20px;
      margin: 10px 5px;
      border: none;
      font-size: 16px;
      cursor: pointer;
      background-color: #007bff;
      color: #fff;
      border-radius: 5px;
      transition: background 0.3s;
      display: inline-block;
    }
    .button:hover {
      background-color: #0056b3;
    }
    /* Forced gold background for Product Upgrade button */
    .gold-button {
      background-color: #FFD700 !important;
      color: #000 !important;
      font-weight: normal;
    }
    .money-line {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    .cooldown {
      font-size: 14px;
      color: #bbb;
    }
    .upgrade-container,
    .employee-container,
    .prestige-container {
      margin-top: 20px;
      padding: 15px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      display: flex;
      flex-wrap: wrap;
      justify-content: space-around;
    }
    .upgrade,
    .employee {
      flex: 1 1 45%;
      margin: 5px;
      padding: 10px;
      background: rgba(0, 0, 0, 0.5);
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.3s;
    }
    .upgrade:hover,
    .employee:hover {
      background: rgba(0, 0, 0, 0.7);
    }
    /* Menus (Prestige / Stats) */
    .modal-menu {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #222;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(255, 255, 255, 0.2);
      z-index: 1000;
      max-width: 80%;
      font-size: 14px;
    }
    .modal-menu h2 {
      margin-top: 0;
    }
    /* Notification for VIP or other messages */
    .notification {
      position: fixed;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      background-color: rgba(0,0,0,0.8);
      color: #fff;
      padding: 10px 20px;
      border-radius: 5px;
      display: none;
      z-index: 2000;
      max-width: 70%;
      font-size: 16px;
    }
    /* QR code in bottom-left corner */
    .qr-container {
      position: fixed;
      bottom: 10px;
      left: 10px;
      width: 100px;
      height: 100px;
      z-index: 1500;
    }
    .qr-container img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
  </style>
</head>
<body>
  <!-- Notification div (for VIP / challenge notifications) -->
  <div class="notification" id="notificationBox"></div>

  <div class="container">
    <!-- Money and Prestige on same line -->
    <p class="money-line">
      üí∞ Money: $<span id="money">0.00</span> 
      | üåü Prestige Points: <span id="prestigePoints">0</span>
    </p>

    <p>üîÑ Multiplier: x<span id="multiplier">1.00</span> | Prestige Multi: x<span id="prestigeMulti">1.00</span></p>

    <h2>üè≠ Factory Production</h2>
    <p>üè≠ Factory: <span id="factoryName"></span></p>
    <p>
      üì¶ Product: 
      <span id="productName"></span> 
      (Base: <span id="productBase">0</span>, 
      Batch: <span id="productBatch">1</span>)
    </p>
    <button class="button" id="produce">üöÄ Produce Product</button>
    <p class="cooldown" id="cooldown">‚è≥ Cooldown: Ready</p>

    <!-- Upgrades Section -->
    <div class="upgrade-container">
      <h2 style="width:100%; margin-bottom:10px;">üìà Upgrades</h2>
      <div id="upgrades" style="width:100%; display:flex; flex-wrap:wrap; justify-content:center;"></div>
    </div>

    <!-- Employees Section -->
    <div class="employee-container">
      <h2 style="width:100%; margin-bottom:10px;">üë• Employees</h2>
      <div id="employees" style="width:100%; display:flex; flex-wrap:wrap; justify-content:center;"></div>
    </div>

    <!-- Prestige and Stats buttons side-by-side -->
    <div style="margin-top: 20px;">
      <button class="button" id="prestige">üîÑ Prestige</button>
      <button class="button" id="statsBtn">üìä Stats</button>
    </div>

    <!-- Credits -->
    <p style="margin-top: 30px;">
      Made By 
      <a href="https://your-website-url-here.com" target="_blank" style="color: #00d1ff;">Static</a>
    </p>
  </div>

  <!-- QR Code (bottom-left) -->
  <div class="qr-container">
    <a href="https://your-website-url-here.com" target="_blank">
      <img 
        src="https://res-console.cloudinary.com/dcsrqennd/thumbnails/v1/image/upload/v1733694622/ZnJhbWVfMV92bXY5eTM=/drilldown" 
        alt="Qr Code linking to Static's site" 
        title="Click to visit Static's site"
      />
    </a>
  </div>

  <!-- Prestige Menu -->
  <div class="modal-menu" id="prestigeMenu">
    <h2>üîÑ Prestige Confirmation</h2>
    <p>
      <strong>Warning:</strong> Prestiging will reset your current money, multiplier, upgrades,
      employee progress, product batch size, and production count.  
      Your <em>Total Earned Money</em> remains for calculating Prestige Points (1 PP per $1K earned).
    </p>
    <p>Requirement: You must have at least $1K on hand to gain additional PP.</p>
    <p>Your Current Prestige Points: <span id="livePP">0</span></p>
    <p>Potential Prestige Points Gain: <span id="earnedPP">0</span></p>
    <p>üè≠ Current Factory: <span id="currentFactory"></span></p>
    <p>üè≠ Next Factory: <span id="nextFactory"></span></p>
    <p>üì¶ Base Product Value: <span id="baseValue"></span></p>
    <p>üì¶ Best Product Value: <span id="bestValue"></span></p>

    <!-- Prestige Upgrades appear only here -->
    <div id="prestigeUpgradesMenu"></div>

    <button class="button" id="confirmPrestige">‚úî Confirm</button>
    <button class="button" id="closePrestige">‚ùå Cancel</button>
  </div>

  <!-- Stats Menu -->
  <div class="modal-menu" id="statsMenu">
    <h2>üìä Player Stats</h2>
    <div id="statsContent"></div>
    <button class="button" id="closeStats">‚ùå Close</button>
  </div>

  <script>
    "use strict";

    /* =======================
       Utility: Number Formatting
    ========================== */
    function formatNumber(num) {
      if (num >= 1e9) {
        return (num / 1e9).toFixed(1) + " Billion";
      } else if (num >= 1e6) {
        return (num / 1e6).toFixed(1) + " Million";
      } else if (num >= 1e3) {
        return (num / 1e3).toFixed(1) + "K";
      } else {
        return num.toFixed(2);
      }
    }

    /* =======================
       Game State Initialization
    ========================== */
    let money = parseFloat(localStorage.getItem("money")) || 0;
    let totalEarned = parseFloat(localStorage.getItem("totalEarned")) || 0;
    let prestigePoints = parseInt(localStorage.getItem("prestigePoints")) || 0;
    let multiplier = parseFloat(localStorage.getItem("multiplier")) || 1;
    let prestigeMulti = parseFloat(localStorage.getItem("prestigeMulti")) || 1;
    let totalProductsProduced = parseInt(localStorage.getItem("totalProductsProduced")) || 0;
    let challengeBonusApplied = localStorage.getItem("challengeBonusApplied") === "true";
    let productBatch = parseInt(localStorage.getItem("productBatch")) || 1;

    let factoryIndex = parseInt(localStorage.getItem("factoryIndex")) || 0;
    let currentProductIndex = parseInt(localStorage.getItem("currentProductIndex")) || 0;
    let producing = false;
    const baseCooldownTime = 5000; // in ms
    let cooldownTime = parseInt(localStorage.getItem("cooldownTime")) || baseCooldownTime;

    // VIP Variables
    let vipChance = parseFloat(localStorage.getItem("vipChance")) || 0.05; // 5% chance
    let vipMultiplier = parseFloat(localStorage.getItem("vipMultiplier")) || 20; // 20x bonus

    /* =======================
       Factories & Products
    ========================== */
    const factories = [
      {
        name: "üß∏ Children's Toys Factory",
        bg: "linear-gradient(to right, #ff9a9e, #fad0c4)",
        products: [
          { name: "Wooden Blocks", base: 10 },
          { name: "Toy Cars", base: 15 },
          { name: "Stuffed Animals", base: 20 },
          { name: "Puzzle Games", base: 25 },
          { name: "Action Figures", base: 30 },
          { name: "Dollhouses", base: 35 },
          { name: "Remote Control Cars", base: 40 },
          { name: "Educational Kits", base: 45 },
          { name: "Model Trains", base: 50 },
          { name: "Custom Playsets", base: 60 }
        ]
      },
      {
        name: "üç∞ Sweet Treats Bakery",
        bg: "linear-gradient(to right, #fbc2eb, #a6c1ee)",
        products: [
          { name: "Cupcakes", base: 12 },
          { name: "Cookies", base: 18 },
          { name: "Brownies", base: 24 },
          { name: "Donuts", base: 30 },
          { name: "Muffins", base: 36 },
          { name: "Pastries", base: 42 },
          { name: "Cakes", base: 50 },
          { name: "Macarons", base: 58 },
          { name: "Eclairs", base: 66 },
          { name: "Gourmet Pies", base: 75 }
        ]
      },
      {
        name: "üé® Artisan Crafts Workshop",
        bg: "linear-gradient(to right, #a1c4fd, #c2e9fb)",
        products: [
          { name: "Handmade Cards", base: 14 },
          { name: "Ceramic Mugs", base: 20 },
          { name: "Knitted Scarves", base: 26 },
          { name: "Wooden Toys", base: 32 },
          { name: "Painted Vases", base: 38 },
          { name: "Handcrafted Jewelry", base: 44 },
          { name: "Embroidered Pillows", base: 50 },
          { name: "Custom Furniture", base: 58 },
          { name: "Vintage Clocks", base: 66 },
          { name: "Bespoke Art Pieces", base: 75 }
        ]
      },
      {
        name: "üì± Tech Gadget Studio",
        bg: "linear-gradient(to right, #a18cd1, #fbc2eb)",
        products: [
          { name: "Smartphone Cases", base: 16 },
          { name: "Wireless Earbuds", base: 22 },
          { name: "Portable Chargers", base: 28 },
          { name: "Bluetooth Speakers", base: 34 },
          { name: "Smartwatches", base: 40 },
          { name: "Tablet Accessories", base: 46 },
          { name: "VR Headsets", base: 52 },
          { name: "Drone Kits", base: 60 },
          { name: "Gaming Controllers", base: 68 },
          { name: "Advanced Gadgets", base: 78 }
        ]
      },
      {
        name: "üíé Luxury Gift Atelier",
        bg: "linear-gradient(to right, #ffecd2, #fcb69f)",
        products: [
          { name: "Artisanal Chocolates", base: 18 },
          { name: "Designer Scarves", base: 26 },
          { name: "Luxury Candles", base: 34 },
          { name: "Fine Wines", base: 42 },
          { name: "Handcrafted Jewelry", base: 50 },
          { name: "Exclusive Perfumes", base: 58 },
          { name: "Gourmet Baskets", base: 66 },
          { name: "Limited Edition Watches", base: 74 },
          { name: "Premium Leather Goods", base: 82 },
          { name: "Custom Masterpieces", base: 90 }
        ]
      }
    ];

    /* =======================
       Upgrades & Employees
    ========================== */
    let upgrades = JSON.parse(localStorage.getItem("upgrades")) || [
      { name: "Quality Increase", cost: 25, effect: 1.5, description: "Increase production multiplier by 50%." },
      { name: "‚öôÔ∏è Speedy Assembly", cost: 50, effect: 0.9, description: "Reduce production cooldown by 10%." },
      { name: "Product Upgrade", cost: 250, effect: "upgradeProduct", description: "Upgrade product to the next tier." },
      { name: "üè≠ Factory Expansion", cost: 200, effect: 0.95, description: "Reduce production cooldown by 5%." },
      { name: "üì¶ Batch Production", cost: 400, effect: "increaseBatch", description: "Increase products produced per click by 1." }
    ];

    let employees = JSON.parse(localStorage.getItem("employees")) || [
      { name: "üë∑ Efficient Operator", cost: 75, rate: 1, quantity: 0, description: "Generates $1/sec per operator." },
      { name: "üë®‚Äçüîß Skilled Worker", cost: 250, rate: 5, quantity: 0, description: "Generates $5/sec per worker." },
      { name: "üõ†Ô∏è Master Craftsman", cost: 1000, rate: 20, quantity: 0, description: "Generates $20/sec per craftsman." },
      { name: "üèÜ Production Supervisor", cost: 4000, rate: 50, quantity: 0, description: "Generates $50/sec per supervisor." },
      { name: "üíº Operations Manager", cost: 7500, rate: 100, quantity: 0, description: "Generates $100/sec per manager." }
    ];

    // Employee Training
    let employeeTraining = JSON.parse(localStorage.getItem("employeeTraining")) || {
      unlocked: false,
      cost: 150,
      effect: 1.2,
      purchased: false,
      description: "Increase all employee production by 20%."
    };

    // Prestige Upgrades (Permanent)
    let prestigeUpgrades = JSON.parse(localStorage.getItem("prestigeUpgrades")) || [
      { name: "Divine Efficiency ‚ú®", cost: 5, effect: 1.1, description: "Permanently increase multiplier by 10%." },
      { name: "Temporal Mastery ‚è≥", cost: 10, effect: 0.95, description: "Permanently reduce cooldown by 5%." },
      { name: "Cosmic Workforce üöÄ", cost: 15, effect: 1.2, description: "Permanently boost employee production by 20%." },
      { name: "Galactic Expansion üöÄ", cost: 20, effect: 1.15, description: "Permanently boost multiplier by 15%." },
      { name: "Eternal Workshop üè≠", cost: 25, effect: 1.25, description: "Permanently increase product base value by 25%." },
      { name: "Prestige Pure Multi", cost: 1, effect: 1.1, description: "Increase your Prestige Multi by 10%." },
      { name: "Prestige Auto-Operator", cost: 8, effect: 1.2, description: "Boost automatic production by 20%." },
      { name: "VIP Client Order", cost: 30, effect: 1, description: "Increase VIP order chance by 2% and VIP multiplier by 5% per purchase." }
    ];

    /* =======================
       Saving & Background
    ========================== */
    function saveGame() {
      localStorage.setItem("money", money);
      localStorage.setItem("totalEarned", totalEarned);
      localStorage.setItem("prestigePoints", prestigePoints);
      localStorage.setItem("multiplier", multiplier);
      localStorage.setItem("prestigeMulti", prestigeMulti);
      localStorage.setItem("cooldownTime", cooldownTime);
      localStorage.setItem("upgrades", JSON.stringify(upgrades));
      localStorage.setItem("employees", JSON.stringify(employees));
      localStorage.setItem("employeeTraining", JSON.stringify(employeeTraining));
      localStorage.setItem("prestigeUpgrades", JSON.stringify(prestigeUpgrades));
      localStorage.setItem("factoryIndex", factoryIndex);
      localStorage.setItem("currentProductIndex", currentProductIndex);
      localStorage.setItem("totalProductsProduced", totalProductsProduced);
      localStorage.setItem("challengeBonusApplied", challengeBonusApplied);
      localStorage.setItem("productBatch", productBatch);
      localStorage.setItem("vipChance", vipChance);
      localStorage.setItem("vipMultiplier", vipMultiplier);
    }

    function updateBackground() {
      document.body.style.background = factories[factoryIndex].bg;
    }

    /* =======================
       UI Update
    ========================== */
    function updateUI() {
      document.getElementById("money").innerText = formatNumber(money);
      document.getElementById("prestigePoints").innerText = prestigePoints;
      document.getElementById("multiplier").innerText = multiplier.toFixed(2);
      document.getElementById("prestigeMulti").innerText = prestigeMulti.toFixed(2);

      const currentFactory = factories[factoryIndex];
      document.getElementById("factoryName").innerText = currentFactory.name;

      const currentProduct = currentFactory.products[currentProductIndex];
      document.getElementById("productName").innerText = currentProduct.name;
      document.getElementById("productBase").innerText = currentProduct.base;
      document.getElementById("productBatch").innerText = productBatch;

      renderUpgrades();
      renderEmployees();
      renderEmployeeTraining();
      updatePrestigeMenu(); 
      saveGame();
      updateBackground();
    }

    /* =======================
       Notification (VIP, etc.)
    ========================== */
    function showNotification(message) {
      const box = document.getElementById("notificationBox");
      box.innerText = message;
      box.style.display = "block";
      // Hide after 3 seconds
      setTimeout(() => {
        box.style.display = "none";
      }, 3000);
    }

    /* =======================
       Upgrades
    ========================== */
    function renderUpgrades() {
      const container = document.getElementById("upgrades");
      container.innerHTML = "";
      upgrades.forEach((upg, index) => {
        const btn = document.createElement("button");
        btn.className = "button upgrade";

        // Distinguish "Product Upgrade" with forced gold style
        if (upg.name === "Product Upgrade") {
          btn.classList.add("gold-button");
          const nextProd = factories[factoryIndex].products[currentProductIndex + 1];
          if (nextProd) {
            btn.innerText = `${upg.name} ($${formatNumber(upg.cost)})`;
            btn.title = `Next: ${nextProd.name} (Base: ${nextProd.base})`;
          } else {
            btn.innerText = `${upg.name} (Maxed)`;
            btn.disabled = true;
          }
        } 
        else if (upg.effect === "increaseBatch") {
          btn.innerText = `${upg.name} ($${formatNumber(upg.cost)})`;
          btn.title = `Increase batch size to ${productBatch + 1}`;
        } 
        else {
          btn.innerText = `${upg.name} ($${formatNumber(upg.cost)})`;
          btn.title = upg.description;
        }

        btn.onclick = () => purchaseUpgrade(index);
        container.appendChild(btn);
      });
    }

    function purchaseUpgrade(index) {
      const upg = upgrades[index];
      if (money >= upg.cost) {
        money -= upg.cost;

        if (upg.name === "‚öôÔ∏è Speedy Assembly") {
          cooldownTime = Math.max(Math.round(cooldownTime * upg.effect), 100);
        } 
        else if (upg.name === "Product Upgrade") {
          if (currentProductIndex < factories[factoryIndex].products.length - 1) {
            currentProductIndex++;
          }
          upg.cost = Math.round(upg.cost * 2.5);
          updateUI();
          return;
        } 
        else if (upg.name === "üè≠ Factory Expansion") {
          cooldownTime = Math.max(Math.round(cooldownTime * upg.effect), 100);
        } 
        else if (upg.effect === "increaseBatch") {
          productBatch++;
        } 
        else {
          multiplier *= upg.effect;
        }

        if (upg.name !== "Product Upgrade") {
          upg.cost = Math.round(upg.cost * 1.6);
        }
        updateUI();
      }
    }

    /* =======================
       Employees
    ========================== */
    function renderEmployees() {
      const container = document.getElementById("employees");
      container.innerHTML = "";
      employees.forEach((emp, index) => {
        const btn = document.createElement("button");
        btn.className = "button employee";
        btn.innerText = `${emp.name} (x${emp.quantity}) - $${formatNumber(emp.cost)}`;
        btn.title = emp.description;
        btn.onclick = () => purchaseEmployee(index);
        container.appendChild(btn);
      });
    }

    function purchaseEmployee(index) {
      const emp = employees[index];
      if (money >= emp.cost) {
        money -= emp.cost;
        emp.quantity++;
        emp.cost = Math.round(emp.cost * 1.5);
        if (!employeeTraining.unlocked) {
          employeeTraining.unlocked = true;
        }
        updateUI();
      }
    }

    function renderEmployeeTraining() {
      if (employeeTraining.unlocked && !employeeTraining.purchased) {
        const container = document.getElementById("upgrades");
        const btn = document.createElement("button");
        btn.className = "button upgrade";
        btn.innerText = `üèãÔ∏è Employee Training ($${formatNumber(employeeTraining.cost)})`;
        btn.title = employeeTraining.description;
        btn.onclick = purchaseEmployeeTraining;
        container.appendChild(btn);
      }
    }

    function purchaseEmployeeTraining() {
      if (money >= employeeTraining.cost) {
        money -= employeeTraining.cost;
        employeeTraining.purchased = true;
        employees.forEach(emp => {
          emp.rate = Math.round(emp.rate * employeeTraining.effect);
        });
        updateUI();
      }
    }

    /* Passive Income */
    setInterval(() => {
      const totalProduction = employees.reduce((sum, emp) => sum + (emp.rate * emp.quantity), 0);
      if (totalProduction > 0) {
        const earned = totalProduction * multiplier * prestigeMulti;
        money += earned;
        totalEarned += earned;
        updateUI();
      }
    }, 1000);

    /* =======================
       Manual Production
    ========================== */
    document.getElementById("produce").addEventListener("click", function() {
      if (!producing) {
        producing = true;
        let countdown = cooldownTime;
        const interval = setInterval(() => {
          countdown -= 100;
          document.getElementById("cooldown").innerText = "‚è≥ Cooldown: " + (countdown / 1000).toFixed(2) + "s";
          if (countdown <= 0) {
            clearInterval(interval);
            const product = factories[factoryIndex].products[currentProductIndex];
            let earned = product.base * multiplier * prestigeMulti * productBatch;

            if (Math.random() < vipChance) {
              earned *= vipMultiplier;
              showNotification(`VIP order! +${vipMultiplier}x bonus`);
            }
            money += earned;
            totalEarned += earned;
            totalProductsProduced++;
            checkChallenge();
            updateUI();
            producing = false;
            document.getElementById("cooldown").innerText = "‚è≥ Cooldown: Ready";
          }
        }, 100);
      }
    });

    /* Simple Challenge: +10% multiplier after 100 products */
    function checkChallenge() {
      if (!challengeBonusApplied && totalProductsProduced >= 100) {
        multiplier *= 1.1;
        challengeBonusApplied = true;
        showNotification("Challenge Completed: Production Mastery! +10% multiplier.");
      }
    }

    /* =======================
       Prestige
    ========================== */
    function updatePrestigeMenu() {
      const availablePP = Math.max(Math.floor(totalEarned / 1000) - prestigePoints, 0);
      document.getElementById("earnedPP").innerText = availablePP;
      document.getElementById("livePP").innerText = prestigePoints;

      document.getElementById("currentFactory").innerText = factories[factoryIndex].name;
      const nextFactory = factories[factoryIndex + 1] ? factories[factoryIndex + 1].name : "No Further Factories";
      document.getElementById("nextFactory").innerText = nextFactory;

      const baseValue = factories[factoryIndex].products[0].base;
      const bestValue = factories[factoryIndex].products[factories[factoryIndex].products.length - 1].base;
      document.getElementById("baseValue").innerText = baseValue;
      document.getElementById("bestValue").innerText = bestValue;

      renderPrestigeUpgrades(); 

      const confirmBtn = document.getElementById("confirmPrestige");
      if (money < 1000) {
        confirmBtn.disabled = true;
        confirmBtn.innerText = "Not Enough Money";
      } else {
        confirmBtn.disabled = false;
        confirmBtn.innerText = "‚úî Confirm";
      }
    }

    function renderPrestigeUpgrades() {
      const container = document.getElementById("prestigeUpgradesMenu");
      container.innerHTML = "<h3>Prestige Upgrades</h3>";
      prestigeUpgrades.forEach((pupg, i) => {
        const btn = document.createElement("button");
        btn.className = "button";
        btn.innerText = `${pupg.name} (Cost: ${formatNumber(pupg.cost)} PP)`;
        btn.title = pupg.description;
        btn.onclick = () => purchasePrestigeUpgrade(i);
        container.appendChild(btn);
      });
    }

    function purchasePrestigeUpgrade(index) {
      const pupg = prestigeUpgrades[index];
      if (prestigePoints >= pupg.cost) {
        prestigePoints -= pupg.cost;
        if (pupg.name.includes("Divine Efficiency")) {
          multiplier *= pupg.effect;
        } 
        else if (pupg.name.includes("Temporal Mastery")) {
          cooldownTime = Math.round(cooldownTime * pupg.effect);
        } 
        else if (pupg.name.includes("Cosmic Workforce")) {
          employees.forEach(emp => {
            emp.rate = Math.round(emp.rate * pupg.effect);
          });
        } 
        else if (pupg.name.includes("Galactic Expansion")) {
          multiplier *= pupg.effect;
        } 
        else if (pupg.name.includes("Eternal Workshop")) {
          // Increase base product value for all factories
          factories.forEach(f => {
            f.products.forEach(p => {
              p.base = Math.round(p.base * pupg.effect);
            });
          });
        } 
        else if (pupg.name.includes("Prestige Pure Multi")) {
          prestigeMulti *= pupg.effect;
        } 
        else if (pupg.name.includes("Prestige Auto-Operator")) {
          employees.forEach(emp => {
            emp.rate = Math.round(emp.rate * pupg.effect);
          });
        } 
        else if (pupg.name.includes("VIP Client Order")) {
          vipChance += 0.02;
          vipMultiplier *= 1.05;
        }
        pupg.cost = Math.round(pupg.cost * 1.5);
        updateUI();
      }
    }

    // Open & Close Prestige Menu
    document.getElementById("prestige").addEventListener("click", () => {
      document.getElementById("prestigeMenu").style.display = "block";
      updatePrestigeMenu();
    });
    document.getElementById("closePrestige").addEventListener("click", () => {
      document.getElementById("prestigeMenu").style.display = "none";
    });

    // Confirm Prestige
    document.getElementById("confirmPrestige").addEventListener("click", () => {
      if (money >= 1000) {
        const newPP = Math.max(Math.floor(totalEarned / 1000) - prestigePoints, 0);
        prestigePoints += newPP;

        money = 0;
        multiplier = 1;
        prestigeMulti = 1;
        cooldownTime = baseCooldownTime;
        currentProductIndex = 0;
        totalProductsProduced = 0;
        challengeBonusApplied = false;
        productBatch = 1;

        if (factoryIndex < factories.length - 1) {
          factoryIndex++;
        }

        // Reset normal upgrades & employees
        upgrades = [
          { name: "Quality Increase", cost: 25, effect: 1.5, description: "Increase production multiplier by 50%." },
          { name: "‚öôÔ∏è Speedy Assembly", cost: 50, effect: 0.9, description: "Reduce production cooldown by 10%." },
          { name: "Product Upgrade", cost: 250, effect: "upgradeProduct", description: "Upgrade product to the next tier." },
          { name: "üè≠ Factory Expansion", cost: 200, effect: 0.95, description: "Reduce production cooldown by 5%." },
          { name: "üì¶ Batch Production", cost: 400, effect: "increaseBatch", description: "Increase products produced per click by 1." }
        ];
        employees = [
          { name: "üë∑ Efficient Operator", cost: 75, rate: 1, quantity: 0, description: "Generates $1/sec per operator." },
          { name: "üë®‚Äçüîß Skilled Worker", cost: 250, rate: 5, quantity: 0, description: "Generates $5/sec per worker." },
          { name: "üõ†Ô∏è Master Craftsman", cost: 1000, rate: 20, quantity: 0, description: "Generates $20/sec per craftsman." },
          { name: "üèÜ Production Supervisor", cost: 4000, rate: 50, quantity: 0, description: "Generates $50/sec per supervisor." },
          { name: "üíº Operations Manager", cost: 7500, rate: 100, quantity: 0, description: "Generates $100/sec per manager." }
        ];
        employeeTraining = {
          unlocked: false,
          cost: 150,
          effect: 1.2,
          purchased: false,
          description: "Increase all employee production by 20%."
        };

        updateUI();
      }
      document.getElementById("prestigeMenu").style.display = "none";
    });

    /* =======================
       Stats Menu
    ========================== */
    document.getElementById("statsBtn").addEventListener("click", () => {
      renderStats();
      document.getElementById("statsMenu").style.display = "block";
    });
    document.getElementById("closeStats").addEventListener("click", () => {
      document.getElementById("statsMenu").style.display = "none";
    });

    function renderStats() {
      const content = document.getElementById("statsContent");
      content.innerHTML = `
        <p><strong>Total Earned:</strong> $${formatNumber(totalEarned)}</p>
        <p><strong>Total Products Produced:</strong> ${totalProductsProduced}</p>
        <p><strong>Current Cooldown:</strong> ${(cooldownTime / 1000).toFixed(2)}s</p>
        <p><strong>VIP Chance:</strong> ${(vipChance * 100).toFixed(2)}%</p>
        <p><strong>VIP Multiplier:</strong> x${vipMultiplier.toFixed(2)}</p>
        <p><strong>Factory Index:</strong> ${factoryIndex + 1} / ${factories.length}</p>
        <p><strong>Product Batch Size:</strong> ${productBatch}</p>
        <p><strong>Multiplier (Normal):</strong> x${multiplier.toFixed(2)}</p>
        <p><strong>Multiplier (Prestige):</strong> x${prestigeMulti.toFixed(2)}</p>
      `;
    }

    /* =======================
       Init
    ========================== */
    window.onload = () => {
      updateUI();
    };
  </script>
</body>
</html>
